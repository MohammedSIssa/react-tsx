import{r as s,u as se,j as e,f as ae,A as j}from"./index-DaHWljq8.js";import{M as d}from"./listbox-B0ufNA1k.js";function re(){const[k,A]=s.useState([]),[w,O]=s.useState(!0),[u,L]=s.useState(""),[R,B]=s.useState(!0),[M,Y]=s.useState([]),[v,q]=s.useState(""),[z,C]=s.useState([]),[F,P]=s.useState(!0),[x,T]=s.useState(""),[m,D]=s.useState(null),[r,$]=s.useState(null),[U,y]=s.useState({}),[p,I]=s.useState(()=>{const t=new Date,a=t.getFullYear(),l=String(t.getMonth()+1).padStart(2,"0"),h=String(t.getDate()).padStart(2,"0");return`${a}-${l}-${h}`}),[f,J]=s.useState(""),[g,Q]=s.useState(""),[c,G]=s.useState(""),[i,H]=s.useState(""),[o,K]=s.useState(""),[_,W]=s.useState(""),[b,X]=s.useState(0),[n,E]=s.useState(!1),[Z,S]=s.useState(""),[ee,N]=s.useState(!1),{language:V}=se();async function te(t){if(t.preventDefault(),x!==""&&u!=="")try{N(!1),E(!0),S(V==="english"?"Adding log...":"جار اضافة سجل.."),(await fetch(`${j}/logs`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(U)})).ok&&(console.log("added"),S(V==="english"?"Added log successfully":"تمت اضافة السجل بنجاح"),y({}))}catch{console.error("failed to add log"),N(!0)}finally{E(!1)}else N(!0),S("يرجى ادخال كود المركبة والبند")}return s.useEffect(()=>{y(t=>({...t,logs_date:p||"",unit:g||"",qty:c?+c:0,unit_cost:i?+i:0,repair_cost:o?+o:0,total_cost:b||0,notes:_||"",order_num:f||""}))},[g,c,i,o,b,p,_,f]),s.useEffect(()=>{async function t(){try{const a=await fetch(`${j}/terms/type/all`);if(a.ok){const l=await a.json();Y(l)}}catch{console.error("Error")}finally{B(!1)}}t()},[]),s.useEffect(()=>{async function t(){try{const a=await fetch(`${j}/vehicles/vcode/all`);if(a.ok){const l=await a.json();A(l)}}catch{console.log("Error.")}finally{O(!1)}}t()},[]),s.useEffect(()=>{async function t(){try{const a=await fetch(`${j}/terms/type/${v}`);if(C([]),T(""),a.ok){const l=await a.json();C(l)}}catch{console.error("ERror")}finally{P(!1)}}v.trim()!==""&&t()},[v]),s.useEffect(()=>{async function t(){try{$(null);const a=await fetch(`${j}/terms/name?search=${x}`);if(a.ok){const l=await a.json();$(l),y(h=>({...h,repair_desc_ar:l.repair_desc_ar,repair_desc_en:l.repair_desc_en,term_num:l.term_num}))}}catch{console.error("Error")}}x!==""&&t()},[x]),s.useEffect(()=>{async function t(){try{D(null);const a=await fetch(`${j}/vehicles/vcode/${u}`);if(a.ok){const l=await a.json();D(l),y(h=>({...h,licence_number:l.licence_number,vehicle_code:l.vehicle_code,vehicle_model_en:l.vehicle_model_en,vehicle_type_ar:l.vehicle_type_ar}))}}catch{console.error("Error")}}u!==""&&t()},[u]),s.useEffect(()=>{const t=+c==1?+o+ +i:+c>1?+o+ +c*+i:null;X(t||0)},[i,c,o]),e.jsxs("div",{className:"p-10",children:[e.jsxs("form",{onSubmit:te,className:"rounded-xl border border-neutral-300 bg-neutral-100 p-10 **:disabled:opacity-25 [&_input,button,textarea,select]:rounded [&_input,button,textarea,select]:p-1 [&_input,button,textarea,select]:focus:outline-0 [&_input,textarea,select]:bg-neutral-300",children:[e.jsxs("div",{className:"flex flex-wrap items-end gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{children:"رقم الطلب"}),e.jsx("input",{value:f,onChange:t=>J(t.target.value),disabled:n}),e.jsx("label",{children:"التاريخ"}),e.jsx("input",{disabled:n,required:!0,type:"date",value:p,onChange:t=>I(t.target.value)}),e.jsx("label",{children:"كود المركبة"}),e.jsx(d,{value:u,onChange:L,disabled:w||n,children:e.jsxs("div",{className:"relative md:max-w-[500px]",children:[e.jsx(d.Button,{className:"w-full rounded bg-neutral-300 p-1 text-right focus:outline-0 disabled:opacity-25",children:u||"-- اختر --"}),e.jsx(d.Options,{className:"absolute z-50 mt-1 max-h-60 w-full overflow-auto rounded bg-white text-right shadow-lg",children:!w&&k.map((t,a)=>e.jsx(d.Option,{value:t,className:({active:l,selected:h})=>`cursor-pointer px-2 py-1 ${l?"bg-neutral-200":""} ${h?"font-bold":""} `,children:t},a))})]})})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{children:"نوع الصيانة"}),e.jsxs("select",{disabled:R||n,value:v,onChange:t=>{q(t.target.value)},children:[e.jsx("option",{value:"",children:"-- اختر--"}),M.map((t,a)=>e.jsx("option",{value:t,children:t},a))]}),e.jsx("label",{children:"بند الصيانة"}),e.jsx(d,{value:x,onChange:T,disabled:F||n,children:e.jsxs("div",{className:"relative md:max-w-[500px]",children:[e.jsx(d.Button,{className:"w-full rounded bg-neutral-300 p-1 text-right focus:outline-0 disabled:opacity-25",children:x||"-- اختر البند --"}),e.jsx(d.Options,{className:"absolute z-50 mt-1 max-h-60 w-full overflow-auto rounded bg-white text-right shadow-lg",children:z.map((t,a)=>e.jsx(d.Option,{value:t,className:({active:l})=>`cursor-pointer px-2 py-1 ${l?"bg-neutral-200":""}`,children:t},a))})]})}),e.jsx("label",{children:"الوحدة"}),e.jsxs("select",{value:g,onChange:t=>Q(t.target.value),disabled:n,children:[e.jsx("option",{value:"",children:"--اختر--"}),e.jsx("option",{value:"لتر",children:"لتر"}),e.jsx("option",{value:"كغم",children:"كغم"}),e.jsx("option",{value:"عدد",children:"عدد"}),e.jsx("option",{value:"أخرى",children:"أخرى"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{children:"كمية التوريد"}),e.jsx("input",{type:"number",disabled:n,value:c,onChange:t=>G(t.target.value)}),e.jsx("label",{children:"تكلفة الوحدة"}),e.jsx("input",{disabled:n,type:"number",value:i,onChange:t=>H(t.target.value)}),e.jsx("label",{children:"تكلفة الصيانة"}),e.jsx("input",{disabled:n,type:"number",value:o,onChange:t=>K(t.target.value)})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 md:max-w-[400px]",children:[e.jsx("label",{children:"ملاحظات:"}),e.jsx("textarea",{disabled:n,value:_??"",className:"resize-none",onChange:t=>W(t.target.value===""?"":t.target.value)})]}),e.jsx("button",{type:"submit",disabled:n,className:"mt-5 rounded bg-blue-500 p-2 font-bold text-white",children:"إضافة السجل"}),e.jsx("p",{className:ee?"text-red-500":n?"text-neutral-600":"text-green-500",children:Z})]}),e.jsxs("div",{className:"preview mt-10",children:[e.jsx("h1",{className:"mb-3 text-xl font-bold",children:"البيانات:"}),e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{className:"[&_th]:font-bold",children:[e.jsx("th",{children:"التاريخ"}),e.jsx("th",{children:"رقم الطلب"}),e.jsx("th",{children:"كود المركبة"}),e.jsx("th",{children:"نوع المركبة"}),e.jsx("th",{children:"رقم اللوحة"}),e.jsx("th",{children:"سنة الإنتاج"}),e.jsx("th",{children:"كود الصيانة"}),e.jsx("th",{children:"البند"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"البيان"}),e.jsx("th",{children:"الوحدة"}),e.jsx("th",{children:"كمية التوريد"}),e.jsx("th",{children:"تكلفة الوحدة"}),e.jsx("th",{children:"تكلفة الصيانة"}),e.jsx("th",{children:"إجمالي المبلغ"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:p!==""&&ae(p)}),e.jsx("td",{children:f}),e.jsx("td",{children:u}),e.jsx("td",{children:m&&m.vehicle_type_ar}),e.jsx("td",{children:m&&m.licence_number}),e.jsx("td",{dir:"ltr",children:m&&m.vehicle_model_en}),e.jsx("td",{children:r&&r.term_num}),e.jsx("td",{children:r&&r.repair_desc_ar}),e.jsx("td",{dir:"ltr",children:r&&r.repair_desc_en}),e.jsx("td",{dir:"ltr",children:r?`${r.term_num} ${r.repair_desc_ar}`:null}),e.jsx("td",{children:g}),e.jsx("td",{children:c}),e.jsx("td",{children:i}),e.jsx("td",{children:o}),e.jsx("td",{children:b>0?b:""})]})})]})]})]})}export{re as default};
