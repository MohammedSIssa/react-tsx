import{r as s,u as re,j as e,M as V,a as k,B as A,I as L,f as M,A as f}from"./index-DmrK3OXr.js";function ie(){const[R,F]=s.useState([]),[w,B]=s.useState(!0),[h,Y]=s.useState(""),[O,U]=s.useState(!0),[q,z]=s.useState([]),[b,I]=s.useState(""),[P,C]=s.useState([]),[Q,J]=s.useState(!0),[m,T]=s.useState(""),[r,$]=s.useState(null),[n,D]=s.useState(null),[G,v]=s.useState({}),[u,H]=s.useState(()=>{const t=new Date,l=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),j=String(t.getDate()).padStart(2,"0");return`${l}-${a}-${j}`}),[p,K]=s.useState(""),[g,W]=s.useState(""),[i,X]=s.useState(""),[d,Z]=s.useState(""),[o,ee]=s.useState(""),[y,te]=s.useState(""),[x,se]=s.useState(0),[c,E]=s.useState(!1),[le,N]=s.useState(""),[ae,S]=s.useState(!1),{language:_}=re();async function ne(t){if(t.preventDefault(),m!==""&&h!=="")try{S(!1),E(!0),N(_==="english"?"Adding log...":"جار اضافة سجل.."),(await fetch(`${f}/logs`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(G)})).ok&&(console.log("added"),N(_==="english"?"Added log successfully":"تمت اضافة السجل بنجاح"),v({}))}catch{console.error("failed to add log"),S(!0)}finally{E(!1)}else S(!0),N("يرجى ادخال كود المركبة والبند")}return s.useEffect(()=>{v(t=>({...t,logs_date:u||"",unit:g||"",qty:i?+i:0,unit_cost:d?+d:0,repair_cost:o?+o:0,total_cost:x||0,notes:y||"",order_num:p||""}))},[g,i,d,o,x,u,y,p]),s.useEffect(()=>{async function t(){try{const l=await fetch(`${f}/terms/type/all`);if(l.ok){const a=await l.json();z(a)}}catch{console.error("Error")}finally{U(!1)}}t()},[]),s.useEffect(()=>{async function t(){try{const l=await fetch(`${f}/vehicles/vcode/all`);if(l.ok){const a=await l.json();F(a)}}catch{console.log("Error.")}finally{B(!1)}}t()},[]),s.useEffect(()=>{async function t(){try{const l=await fetch(`${f}/terms/type/${b}`);if(C([]),T(""),l.ok){const a=await l.json();C(a)}}catch{console.error("ERror")}finally{J(!1)}}b.trim()!==""&&t()},[b]),s.useEffect(()=>{async function t(){try{D(null);const l=await fetch(`${f}/terms/name?search=${m}`);if(l.ok){const a=await l.json();D(a),v(j=>({...j,repair_desc_ar:a.repair_desc_ar,repair_desc_en:a.repair_desc_en,term_num:a.term_num}))}}catch{console.error("Error")}}m!==""&&t()},[m]),s.useEffect(()=>{async function t(){try{$(null);const l=await fetch(`${f}/vehicles/vcode/${h}`);if(l.ok){const a=await l.json();$(a),v(j=>({...j,licence_number:a.licence_number,vehicle_code:a.vehicle_code,vehicle_model_ar:a.vehicle_model_ar,vehicle_model_en:a.vehicle_model_en,vehicle_type_ar:a.vehicle_type_ar}))}}catch{console.error("Error")}}h!==""&&t()},[h]),s.useEffect(()=>{const t=+i==1?+o+ +d:+i>1?+o+ +i*+d:null;se(t||0)},[d,i,o]),e.jsxs("div",{className:"p-10",children:[e.jsxs("form",{onSubmit:ne,className:"rounded-xl border border-neutral-300 bg-neutral-100 p-10 **:disabled:opacity-25 [&_input,button,textarea,select]:rounded [&_input,button,textarea,select]:p-1 [&_input,button,textarea,select]:focus:outline-0 [&_input,textarea,select]:bg-neutral-300",children:[e.jsxs("div",{className:"flex flex-wrap items-end gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{children:"رقم الطلب"}),e.jsx("input",{value:p,onChange:t=>K(t.target.value),disabled:c}),e.jsx("label",{children:"التاريخ"}),e.jsx("input",{disabled:c,required:!0,type:"date",value:u,onChange:t=>H(t.target.value)}),e.jsx("label",{children:"كود المركبة"}),e.jsx(V,{value:h,onChange:Y,disabled:w||c,children:e.jsxs("div",{className:"relative md:max-w-[500px]",children:[e.jsx(k,{className:"w-full rounded bg-neutral-300 p-1 text-right focus:outline-0 disabled:opacity-25",children:h||"-- اختر --"}),e.jsx(A,{className:"absolute z-50 mt-1 max-h-60 w-full overflow-auto rounded bg-white text-right shadow-lg",children:!w&&R.map((t,l)=>e.jsx(L,{value:t,className:({active:a,selected:j})=>`cursor-pointer px-2 py-1 ${a?"bg-neutral-200":""} ${j?"font-bold":""} `,children:t},l))})]})})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{children:"نوع الصيانة"}),e.jsxs("select",{disabled:O||c,value:b,onChange:t=>{I(t.target.value)},children:[e.jsx("option",{value:"",children:"-- اختر--"}),q.map((t,l)=>e.jsx("option",{value:t,children:t},l))]}),e.jsx("label",{children:"بند الصيانة"}),e.jsx(V,{value:m,onChange:T,disabled:Q||c,children:e.jsxs("div",{className:"relative md:max-w-[500px]",children:[e.jsx(k,{className:"w-full rounded bg-neutral-300 p-1 text-right focus:outline-0 disabled:opacity-25",children:m||"-- اختر البند --"}),e.jsx(A,{className:"absolute z-50 mt-1 max-h-60 w-full overflow-auto rounded bg-white text-right shadow-lg",children:P.map((t,l)=>e.jsx(L,{value:t,className:({active:a})=>`cursor-pointer px-2 py-1 ${a?"bg-neutral-200":""}`,children:t},l))})]})}),e.jsx("label",{children:"الوحدة"}),e.jsxs("select",{value:g,onChange:t=>W(t.target.value),disabled:c,children:[e.jsx("option",{value:"",children:"--اختر--"}),e.jsx("option",{value:"لتر",children:"لتر"}),e.jsx("option",{value:"كغم",children:"كغم"}),e.jsx("option",{value:"عدد",children:"عدد"}),e.jsx("option",{value:"أخرى",children:"أخرى"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{children:"كمية التوريد"}),e.jsx("input",{type:"number",disabled:c,value:i,onChange:t=>X(t.target.value)}),e.jsx("label",{children:"تكلفة الوحدة"}),e.jsx("input",{disabled:c,type:"number",value:d,onChange:t=>Z(t.target.value)}),e.jsx("label",{children:"تكلفة الصيانة"}),e.jsx("input",{disabled:c,type:"number",value:o,onChange:t=>ee(t.target.value)})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 md:max-w-[400px]",children:[e.jsx("label",{children:"ملاحظات:"}),e.jsx("textarea",{disabled:c,value:y??"",className:"resize-none",onChange:t=>te(t.target.value===""?"":t.target.value)})]}),e.jsx("button",{type:"submit",disabled:c,className:"mt-5 rounded bg-blue-500 p-2 font-bold text-white",children:"إضافة السجل"}),e.jsx("p",{className:ae?"text-red-500":c?"text-neutral-600":"text-green-500",children:le})]}),e.jsxs("div",{className:"preview mt-10",children:[e.jsx("h1",{className:"mb-3 text-xl font-bold",children:"البيانات:"}),e.jsxs("table",{children:[e.jsx("thead",{children:e.jsx("tr",{className:"[&_th]:font-bold",children:_==="english"?e.jsxs(e.Fragment,{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Order Number"}),e.jsx("th",{children:"Vehicle Code"}),e.jsx("th",{children:"Vehicle Type"}),e.jsx("th",{children:"Licence Number"}),e.jsx("th",{children:"Model"}),e.jsx("th",{children:"Term Number"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Statement"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{children:"Quantity"}),e.jsx("th",{children:"Unit Cost"}),e.jsx("th",{children:"Repair Cost"}),e.jsx("th",{children:"Total Cost"})]}):e.jsxs(e.Fragment,{children:[e.jsx("th",{children:"التاريخ"}),e.jsx("th",{children:"رقم الطلب"}),e.jsx("th",{children:"كود المركبة"}),e.jsx("th",{children:"نوع المركبة"}),e.jsx("th",{children:"رقم اللوحة"}),e.jsx("th",{children:"سنة الإنتاج"}),e.jsx("th",{children:"كود الصيانة"}),e.jsx("th",{children:"البند"}),e.jsx("th",{children:"البيان"}),e.jsx("th",{children:"الوحدة"}),e.jsx("th",{children:"كمية التوريد"}),e.jsx("th",{children:"تكلفة الوحدة"}),e.jsx("th",{children:"تكلفة الصيانة"}),e.jsx("th",{children:"إجمالي المبلغ"})]})})}),e.jsx("tbody",{children:e.jsx("tr",{children:_==="english"?e.jsxs(e.Fragment,{children:[e.jsx("td",{children:u!==""&&M(u)}),e.jsx("td",{children:p}),e.jsx("td",{children:h}),e.jsx("td",{children:r&&r.vehicle_type_en}),e.jsx("td",{children:r&&r.licence_number}),e.jsx("td",{dir:"ltr",children:r&&r.vehicle_model_en}),e.jsx("td",{children:n&&n.term_num}),e.jsx("td",{dir:"ltr",children:n&&n.repair_desc_en}),e.jsx("td",{dir:"ltr",children:n?`${n.term_num} ${n.repair_desc_en}`:null}),e.jsx("td",{children:g}),e.jsx("td",{children:i}),e.jsx("td",{children:d}),e.jsx("td",{children:o}),e.jsx("td",{children:x>0?x:""})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{children:u!==""&&M(u)}),e.jsx("td",{children:p}),e.jsx("td",{children:h}),e.jsx("td",{children:r&&r.vehicle_type_ar}),e.jsx("td",{children:r&&r.licence_number}),e.jsx("td",{children:r&&r.vehicle_model_ar}),e.jsx("td",{children:n&&n.term_num}),e.jsx("td",{children:n&&n.repair_desc_ar}),e.jsx("td",{dir:"ltr",children:n?`${n.term_num} ${n.repair_desc_ar}`:null}),e.jsx("td",{children:g}),e.jsx("td",{children:i}),e.jsx("td",{children:d}),e.jsx("td",{children:o}),e.jsx("td",{children:x>0?x:""})]})})})]})]})]})}export{ie as default};
